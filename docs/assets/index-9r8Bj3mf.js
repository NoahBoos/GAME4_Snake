var ve=Object.defineProperty;var Ce=(o,t,e)=>t in o?ve(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var a=(o,t,e)=>Ce(o,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const r=20;let le=-1;function W(o){le=o}let g=new Array;class X{constructor(t,e,s,i,n){this.context=t,this.terrain=e,this.coordinateX=0,this.coordinateY=0,this.texture=s,this.experience=i,this.segmentsToAdd=n}DrawFruit(){let t=new Image;t.src=this.texture,t.onload=()=>{this.context.drawImage(t,this.coordinateX-5,this.coordinateY-5,r*1.5,r*1.5)}}WriteFruitCell(){this.terrain.WriteTerrainCell(this.coordinateX/r,this.coordinateY/r,!0,"sweetFruit",this)}DefineCoordinates(){const t=this.terrain;let e,s=this.terrain.ReadTerrainCell(0,0);do e=ue(t.terrainWidth,t.terrainHeight),s=t.ReadTerrainCell(e.coordinateX,e.coordinateY);while(s.isOccupied===!0);this.coordinateX=e.coordinateX*r,this.coordinateY=e.coordinateY*r}}const m=class m extends X{constructor(t,e){super(t,e,m.texture,m.experience,m.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(m,"texture","./svg/Strawberry.svg"),a(m,"experience",25),a(m,"segmentsToAdd",1);let O=m;const f=class f extends X{constructor(t,e){super(t,e,f.texture,f.experience,f.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(f,"texture","./svg/Banana.svg"),a(f,"experience",150),a(f,"segmentsToAdd",6);let B=f;class y{constructor(t,e,s,i,n){this.context=t,this.terrain=e,this.coordinateX=0,this.coordinateY=0,this.texture=s,this.experience=i,this.segmentsToRemove=n}DrawFruit(){let t=new Image;t.src=this.texture,t.onload=()=>{this.context.drawImage(t,this.coordinateX-5,this.coordinateY-5,r*1.5,r*1.5)}}WriteFruitCell(){this.terrain.WriteTerrainCell(this.coordinateX/r,this.coordinateY/r,!0,"sourFruit",this)}DefineCoordinates(){const t=this.terrain;let e,s=this.terrain.ReadTerrainCell(0,0);do e=ue(t.terrainWidth,t.terrainHeight),s=t.ReadTerrainCell(e.coordinateX,e.coordinateY);while(s.isOccupied===!0);this.coordinateX=e.coordinateX*r,this.coordinateY=e.coordinateY*r}}const x=class x extends y{constructor(t,e){super(t,e,x.texture,x.experience,x.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(x,"texture","./svg/Lemon.svg"),a(x,"experience",40),a(x,"segmentsToRemove",1);let N=x;const u=class u extends y{constructor(t,e){super(t,e,u.texture,u.experience,u.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(u,"color","#32CD32"),a(u,"texture","./svg/Lime.svg"),a(u,"experience",160),a(u,"segmentsToRemove",5);let U=u;const p=class p extends X{constructor(t,e){super(t,e,p.texture,p.experience,p.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(p,"texture","./svg/Grape.svg"),a(p,"experience",50),a(p,"segmentsToAdd",2);let P=p;const v=class v extends X{constructor(t,e){super(t,e,v.texture,v.experience,v.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(v,"texture","./svg/Peach.svg"),a(v,"experience",75),a(v,"segmentsToAdd",3);let j=v;const C=class C extends X{constructor(t,e){super(t,e,C.texture,C.experience,C.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(C,"texture","./svg/RedApple.svg"),a(C,"experience",175),a(C,"segmentsToAdd",7);let G=C;const T=class T extends y{constructor(t,e){super(t,e,T.texture,T.experience,T.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(T,"texture","./svg/Blueberry.svg"),a(T,"experience",80),a(T,"segmentsToRemove",2);let V=T;const w=class w extends y{constructor(t,e){super(t,e,w.texture,w.experience,w.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(w,"texture","./svg/GreenApple.svg"),a(w,"experience",200),a(w,"segmentsToRemove",7);let q=w;const F=class F extends X{constructor(t,e){super(t,e,F.texture,F.experience,F.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(F,"texture","./svg/Mango.svg"),a(F,"experience",100),a(F,"segmentsToAdd",4);let z=F;const S=class S extends X{constructor(t,e){super(t,e,S.texture,S.experience,S.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(S,"texture","./svg/Melon.svg"),a(S,"experience",125),a(S,"segmentsToAdd",5);let H=S;const E=class E extends y{constructor(t,e){super(t,e,E.texture,E.experience,E.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(E,"texture","./svg/Tangerine.svg"),a(E,"experience",120),a(E,"segmentsToRemove",3);let K=E;class L{constructor(t,e,s=0,i=0,n=!1,h=!0){this.context=t,this.terrain=e,this.coordinateX=s,this.coordinateY=i,this.coordinateX===0&&this.coordinateY===0&&n===!1&&this.DefineCoordinates(),h===!0&&(this.WriteObstacleCell(),this.DrawObstacleCell())}WriteAndDrawObstacleCell(){this.DefineCoordinates(),this.WriteObstacleCell(),this.DrawObstacleCell()}DrawObstacleCell(){this.context.fillStyle="#734210",this.context.fillRect(this.coordinateX,this.coordinateY,r,r)}WriteObstacleCell(){this.terrain.WriteTerrainCell(this.coordinateX/r,this.coordinateY/r,!0,"obstacleCell",this)}DefineCoordinates(){const t=this.terrain;let e,s;do e=Xe(0,t.terrainWidth-4,4,t.terrainHeight-6),s=t.ReadTerrainCell(e.coordinateX,e.coordinateY);while(s.isOccupied===!0);this.coordinateX=e.coordinateX*r,this.coordinateY=e.coordinateY*r}}function Z(o,t,e){const s=t.coordinateX,i=t.coordinateY,n=o.terrain.length,h=o.terrain[0].length,R=s/r,b=i/r;return e.every(([M,pe])=>{const se=R+M,ie=b+pe;return se>=0&&se<n&&ie>=0&&ie<h})}function J(o,t,e,s){const i=e.coordinateX,n=e.coordinateY;for(const[h,R]of s){const b=i+h*r,M=n+R*r;new L(o,t,b,M)}}function Te(o,t=120){if(g.length===0)return!0;for(const e of g){const s=o[0]-e[0],i=o[1]-e[1];if(s<t&&s>-t||i<t&&i>-t)return!1}return!0}function he(o,t){let e=0,s=150;for(let i=0;i<g.length;i++)g.splice(g.indexOf(g[i]),1);for(;e<s;){const i=new L(o,t,0,0,!1,!1),n=[i.coordinateX,i.coordinateY];Te(n)&&(g.push(n),console.log(g),i.WriteAndDrawObstacleCell(),we(o,t,i)),e++}}function we(o,t,e){switch(I(2)){case 0:Fe(o,t,e);break;case 1:Se(o,t,e);break;case 2:Ee(o,t,e);break}}const re=[[0,1],[0,2],[1,2],[2,2],[3,2],[4,2],[4,1],[4,0]],oe=[[1,0],[0,1],[0,2],[2,0],[3,0],[4,0],[4,1],[4,2]],ne=[[1,0],[2,0],[3,0],[4,0],[2,1],[2,2],[2,3],[2,4]];function Fe(o,t,e){Z(t,e,re)?J(o,t,e,re):(console.log(e),t.DrawTerrainCell(e.coordinateX,e.coordinateY))}function Se(o,t,e){Z(t,e,oe)?J(o,t,e,oe):(console.log(e),t.DrawTerrainCell(e.coordinateX,e.coordinateY))}function Ee(o,t,e){Z(t,e,ne)?J(o,t,e,ne):(console.log(e),t.DrawTerrainCell(e.coordinateX,e.coordinateY))}function de(o,t){for(let e=0;e<t.terrain.length;e++)for(let s=0;s<t.terrain[e].length;s++)e===0||e===t.terrain[e].length-1?new L(o,t,e*r,s*r,!0):e!==0&&(s===0||s===t.terrain[e].length-1)&&new L(o,t,e*r,s*r)}function I(o){return Math.floor(Math.random()*(o+1))}function De(){const o=I(255),t=I(255),e=I(255);return"rgb("+o+", "+t+", "+e+")"}function ue(o,t){const e=Math.floor(Math.random()*(o+1)),s=Math.floor(Math.random()*(t+1));return{coordinateX:e,coordinateY:s}}function Xe(o,t,e,s){const i=Math.floor(Math.random()*(t-o+1))+o,n=Math.floor(Math.random()*(s-e+1))+e;return{coordinateX:i,coordinateY:n}}function D(o,t,e){const s=t.availableFruits.reduce((n,h)=>n+h.weight,0);let i=I(s);for(const n of t.availableFruits){if(i<n.weight)return new n.food(o,e);i-=n.weight}}class ge{constructor(t,e,s){this.context=t,this.terrainWidth=e,this.terrainHeight=s,this.terrain=new Array(this.terrainWidth),this.InitializeTerrain()}InitializeTerrain(){for(let t=0;t<this.terrain.length;t++){this.terrain[t]=new Array(this.terrainHeight);for(let e=0;e<this.terrain[t].length;e++)this.WriteTerrainCell(t,e,!1,"ground",null)}}DrawTerrain(){for(let t=0;t<this.terrain.length;t++){this.context.fillStyle=De;for(let e=0;e<this.terrain[t].length;e++)this.context.fillStyle="#FFFFFF",this.context.fillStyle="#fff89e",this.context.fillRect(t*r,e*r,r,r),this.context.strokeRect(t*r,e*r,r,r)}}DrawTerrainCell(t,e){this.context.fillStyle="#FFFFFF",this.context.fillStyle="#fff89e",this.context.fillRect(t,e,r,r),this.context.strokeRect(t,e,r,r),this.WriteTerrainCell(t/r,e/r,!1,"ground",null)}ReadTerrainCell(t,e){return t===35&&(t=34),e===35&&(e=34),this.terrain[t][e]}WriteTerrainCell(t,e,s,i,n){this.terrain[t][e]={isOccupied:s,type:i,object:n}}}class ae{constructor(t,e,s,i="#71B340"){this.context=t,this.coordinateX=e,this.coordinateY=s,this.color=i}DrawSegment(){this.context.fillStyle=this.color,this.context.fillRect(this.coordinateX,this.coordinateY,r,r)}MoveSegment(t,e){this.coordinateX=t,this.coordinateY=e,this.DrawSegment()}}let Q=0,A=0;const Ye=15,ce=1e3/Ye;function $(o=0,t){Q=requestAnimationFrame(s=>$(s,t)),A===0&&(A=o);let e=o-A;e>=ce&&(t.MoveSnake(le),A=o-e%ce)}function me(){cancelAnimationFrame(Q),Q=0}class fe{constructor(t,e,s,i,n,h,R="#2F4C31"){this.document=t,this.context=e,this.player=s,this.terrain=i,this.coordinateX=n,this.coordinateY=h,this.color=R,this.head=new ae(this.context,this.coordinateX,this.coordinateY,this.color),this.segments=[],this.segments.push(this.head),this.segments[0].DrawSegment(),this.document.addEventListener("keydown",b=>{switch(b.key){case"z":W(0);break;case"s":W(1);break;case"q":W(2);break;case"d":W(3);break}})}MoveSnakeSegments(t,e){for(let s=this.segments.length-1;s>=0;s--)if(s===0){this.segments.length===1&&this.terrain.DrawTerrainCell(this.segments[s].coordinateX,this.segments[s].coordinateY);let i=this.terrain.ReadTerrainCell(t/r,e/r);i.type==="sweetFruit"?(this.AddSegment(i.object.segmentsToAdd),this.player.GainExp(i.object.experience),D(this.context,this.player,this.terrain)):i.type==="sourFruit"?(this.RemoveSegment(i.object.segmentsToRemove),this.player.GainExp(i.object.experience),D(this.context,this.player,this.terrain)):(i.type==="obstacleCell"||i.type==="segment")&&(me(),alert("Dommage, tu as perdu ! Maintenant, tu dois recommencer depuis le début... ;>"),this.player.SaveToLocalStorage()),this.segments[s].MoveSegment(t,e),this.terrain.WriteTerrainCell(t/r,e/r,!0,"head",this)}else{let i=this.segments[s-1].coordinateX,n=this.segments[s-1].coordinateY;s===this.segments.length-1&&(this.terrain.DrawTerrainCell(this.segments[s].coordinateX,this.segments[s].coordinateY),this.terrain.WriteTerrainCell(this.segments[s].coordinateX/r,this.segments[s].coordinateY/r,!1,"ground",null)),this.segments[s].MoveSegment(i,n),this.terrain.WriteTerrainCell(i/r,n/r,!0,"segment",this)}}MoveSnake(t){let e=0,s=0;switch(t){case 0:e=this.segments[0].coordinateX,s=this.segments[0].coordinateY-r,this.MoveSnakeSegments(e,s);break;case 1:e=this.segments[0].coordinateX,s=this.segments[0].coordinateY+r,this.MoveSnakeSegments(e,s);break;case 2:e=this.segments[0].coordinateX-r,s=this.segments[0].coordinateY,this.MoveSnakeSegments(e,s);break;case 3:e=this.segments[0].coordinateX+r,s=this.segments[0].coordinateY,this.MoveSnakeSegments(e,s);break}}AddSegment(t){for(let e=0;e<t;e++){const s=new ae(this.context,600,6e3);this.segments.push(s)}}RemoveSegment(t){for(let e=0;e<t;e++){if(this.segments[this.segments.length-1],this.segments.length===1)return;{const s=this.segments[this.segments.length-1].coordinateX,i=this.segments[this.segments.length-1].coordinateY;this.terrain.DrawTerrainCell(s,i),this.terrain.WriteTerrainCell(s/r,i/r,!1,"ground",null),this.segments.splice(this.segments.length-1,1)}}}}class Re{constructor(t){localStorage.length<=0?this.username=prompt("Quel est votre pseudo ?"):this.username=t,this.accountLevel=1,this.accountExp=0,this.accountExpThreshold=100,this.scalingFactor=1.2,this.availableFruits=[],localStorage.length>0&&this.LoadFromLocalStorage(),this.SetAvailableFruit(),console.log(this.availableFruits)}LoadFromLocalStorage(){this.username=localStorage.getItem("username"),this.accountLevel=parseInt(localStorage.getItem("accountLevel")),this.accountExp=parseInt(localStorage.getItem("accountExp")),this.accountExpThreshold=parseInt(localStorage.getItem("accountExpThreshold"))}SaveToLocalStorage(){localStorage.setItem("username",this.username),localStorage.setItem("accountLevel",this.accountLevel.toString()),localStorage.setItem("accountExp",this.accountExp.toString()),localStorage.setItem("accountExpThreshold",this.accountExpThreshold.toString())}GainExp(t){this.accountExp+=t,this.CheckLevelUp(),this.UpdateExperienceUI()}CheckLevelUp(){for(;this.accountExp>=this.accountExpThreshold;)this.accountExp-=this.accountExpThreshold,this.accountLevel++,this.accountExpThreshold=Math.ceil(this.accountExpThreshold+100)}UpdateExperienceUI(){const t=this.accountExp/this.accountExpThreshold*100,e=document.getElementById("levelTextualIndicator");e.textContent="Niveau "+this.accountLevel+" - "+this.accountExp+" / "+this.accountExpThreshold+" Exp.";const s=document.getElementById("progressBarValue");s.style.width=t+"%"}SetAvailableFruit(){this.accountLevel>=1&&this.availableFruits.push({food:O,weight:1e3}),this.accountLevel>=4&&this.availableFruits.push({food:P,weight:800}),this.accountLevel>=8&&this.availableFruits.push({food:j,weight:600}),this.accountLevel>=16&&this.availableFruits.push({food:z,weight:400}),this.accountLevel>=24&&this.availableFruits.push({food:H,weight:300}),this.accountLevel>=32&&this.availableFruits.push({food:B,weight:100}),this.accountLevel>=40&&this.availableFruits.push({food:G,weight:50}),this.accountLevel>=12&&this.availableFruits.push({food:N,weight:750}),this.accountLevel>=20&&this.availableFruits.push({food:V,weight:500}),this.accountLevel>=28&&this.availableFruits.push({food:K,weight:250}),this.accountLevel>=36&&this.availableFruits.push({food:U,weight:150}),this.accountLevel>=44&&this.availableFruits.push({food:q,weight:25})}}const d=new Re("Rift"),be=document.getElementById("canvas"),l=be.getContext("2d");let c=new ge(l,35,35);c.DrawTerrain();let Y=new fe(document,l,d,c,80,100);Y.segments[0].DrawSegment();$(0,Y);de(l,c);he(l,c);D(l,d,c);D(l,d,c);D(l,d,c);const Ie=document.getElementById("button__reload");Ie.addEventListener("click",o=>{me(),c=null,c=new ge(l,35,35),c.DrawTerrain(),Y=null,Y=new fe(document,l,d,c,80,100),Y.segments[0].DrawSegment(),$(0,Y),he(l,c),de(l,c),D(l,d,c),D(l,d,c),D(l,d,c)});const _=document.getElementById("container__aside"),xe=document.createElement("h1");xe.textContent="Bienvenue, "+d.username+" !";_.appendChild(xe);const ee=document.createElement("h2");ee.id="levelTextualIndicator";ee.textContent="Niveau "+d.accountLevel+" - "+d.accountExp+" / "+d.accountExpThreshold+" Exp.";_.appendChild(ee);const k=document.createElement("div");k.id="progressBar";k.className="progressBar";const te=document.createElement("div");te.id="progressBarValue";te.className="progressBarValue";k.appendChild(te);_.appendChild(k);d.UpdateExperienceUI();
