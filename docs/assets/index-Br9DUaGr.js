var ge=Object.defineProperty;var me=(o,t,e)=>t in o?ge(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var a=(o,t,e)=>me(o,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const r=20;let ae=-1;function I(o){ae=o}let k=new Array;class F{constructor(t,e,s,i,n){this.context=t,this.terrain=e,this.coordinateX=0,this.coordinateY=0,this.texture=s,this.experience=i,this.segmentsToAdd=n}DrawFruit(){let t=new Image;t.src=this.texture,t.onload=()=>{this.context.drawImage(t,this.coordinateX-5,this.coordinateY-5,r*1.5,r*1.5)}}WriteFruitCell(){this.terrain.WriteTerrainCell(this.coordinateX/r,this.coordinateY/r,!0,"sweetFruit",this)}DefineCoordinates(){const t=this.terrain;let e,s=this.terrain.ReadTerrainCell(0,0);do e=ce(t.terrainWidth,t.terrainHeight),s=t.ReadTerrainCell(e.coordinateX,e.coordinateY);while(s.isOccupied===!0);this.coordinateX=e.coordinateX*r,this.coordinateY=e.coordinateY*r}}const d=class d extends F{constructor(t,e){super(t,e,d.texture,d.experience,d.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(d,"texture","./svg/Strawberry.svg"),a(d,"experience",25),a(d,"segmentsToAdd",1);let M=d;const u=class u extends F{constructor(t,e){super(t,e,u.texture,u.experience,u.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(u,"texture","./svg/Banana.svg"),a(u,"experience",150),a(u,"segmentsToAdd",6);let O=u;class b{constructor(t,e,s,i,n){this.context=t,this.terrain=e,this.coordinateX=0,this.coordinateY=0,this.texture=s,this.experience=i,this.segmentsToRemove=n}DrawFruit(){let t=new Image;t.src=this.texture,t.onload=()=>{this.context.drawImage(t,this.coordinateX-5,this.coordinateY-5,r*1.5,r*1.5)}}WriteFruitCell(){this.terrain.WriteTerrainCell(this.coordinateX/r,this.coordinateY/r,!0,"sourFruit",this)}DefineCoordinates(){const t=this.terrain;let e,s=this.terrain.ReadTerrainCell(0,0);do e=ce(t.terrainWidth,t.terrainHeight),s=t.ReadTerrainCell(e.coordinateX,e.coordinateY);while(s.isOccupied===!0);this.coordinateX=e.coordinateX*r,this.coordinateY=e.coordinateY*r}}const g=class g extends b{constructor(t,e){super(t,e,g.texture,g.experience,g.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(g,"texture","./svg/Lemon.svg"),a(g,"experience",40),a(g,"segmentsToRemove",1);let N=g;const l=class l extends b{constructor(t,e){super(t,e,l.texture,l.experience,l.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(l,"color","#32CD32"),a(l,"texture","./svg/Lime.svg"),a(l,"experience",160),a(l,"segmentsToRemove",5);let B=l;const m=class m extends F{constructor(t,e){super(t,e,m.texture,m.experience,m.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(m,"texture","./svg/Grape.svg"),a(m,"experience",50),a(m,"segmentsToAdd",2);let U=m;const f=class f extends F{constructor(t,e){super(t,e,f.texture,f.experience,f.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(f,"texture","./svg/Peach.svg"),a(f,"experience",75),a(f,"segmentsToAdd",3);let P=f;const x=class x extends F{constructor(t,e){super(t,e,x.texture,x.experience,x.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(x,"texture","./svg/RedApple.svg"),a(x,"experience",175),a(x,"segmentsToAdd",7);let j=x;const p=class p extends b{constructor(t,e){super(t,e,p.texture,p.experience,p.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(p,"texture","./svg/Blueberry.svg"),a(p,"experience",80),a(p,"segmentsToRemove",2);let G=p;const v=class v extends b{constructor(t,e){super(t,e,v.texture,v.experience,v.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(v,"texture","./svg/GreenApple.svg"),a(v,"experience",200),a(v,"segmentsToRemove",7);let V=v;const C=class C extends F{constructor(t,e){super(t,e,C.texture,C.experience,C.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(C,"texture","./svg/Mango.svg"),a(C,"experience",100),a(C,"segmentsToAdd",4);let q=C;const T=class T extends F{constructor(t,e){super(t,e,T.texture,T.experience,T.segmentsToAdd),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(T,"texture","./svg/Melon.svg"),a(T,"experience",125),a(T,"segmentsToAdd",5);let z=T;const w=class w extends b{constructor(t,e){super(t,e,w.texture,w.experience,w.segmentsToRemove),this.DefineCoordinates(),this.WriteFruitCell(),this.DrawFruit()}};a(w,"texture","./svg/Tangerine.svg"),a(w,"experience",120),a(w,"segmentsToRemove",3);let H=w;class y{constructor(t,e,s=0,i=0,n=!1,c=!0){this.context=t,this.terrain=e,this.coordinateX=s,this.coordinateY=i,this.coordinateX===0&&this.coordinateY===0&&n===!1&&this.DefineCoordinates(),c===!0&&(this.WriteObstacleCell(),this.DrawObstacleCell())}WriteAndDrawObstacleCell(){this.DefineCoordinates(),this.WriteObstacleCell(),this.DrawObstacleCell()}DrawObstacleCell(){this.context.fillStyle="#734210",this.context.fillRect(this.coordinateX,this.coordinateY,r,r)}WriteObstacleCell(){this.terrain.WriteTerrainCell(this.coordinateX/r,this.coordinateY/r,!0,"obstacleCell",this)}DefineCoordinates(){const t=this.terrain;let e,s;do e=Se(0,t.terrainWidth-4,4,t.terrainHeight-6),s=t.ReadTerrainCell(e.coordinateX,e.coordinateY);while(s.isOccupied===!0);this.coordinateX=e.coordinateX*r,this.coordinateY=e.coordinateY*r}}function Z(o,t,e){const s=t.coordinateX,i=t.coordinateY,n=o.terrain.length,c=o.terrain[0].length,D=s/r,X=i/r;return e.every(([L,ue])=>{const ee=D+L,te=X+ue;return ee>=0&&ee<n&&te>=0&&te<c})}function J(o,t,e,s){const i=e.coordinateX,n=e.coordinateY;for(const[c,D]of s){const X=i+c*r,L=n+D*r;new y(o,t,X,L)}}function fe(o,t=120){if(k.length===0)return!0;for(const e of k){const s=o[0]-e[0],i=o[1]-e[1];if(s<t&&s>-t||i<t&&i>-t)return!1}return!0}function xe(o,t){let e=0,s=150;for(;e<s;){const i=new y(o,t,0,0,!1,!1),n=[i.coordinateX,i.coordinateY];fe(n)&&(k.push(n),i.WriteAndDrawObstacleCell(),pe(o,t,i)),e++}}function pe(o,t,e){switch(Y(2)){case 0:ve(o,t,e);break;case 1:Ce(o,t,e);break;case 2:Te(o,t,e);break}}const se=[[0,1],[0,2],[1,2],[2,2],[3,2],[4,2],[4,1],[4,0]],ie=[[1,0],[0,1],[0,2],[2,0],[3,0],[4,0],[4,1],[4,2]],re=[[1,0],[2,0],[3,0],[4,0],[2,1],[2,2],[2,3],[2,4]];function ve(o,t,e){Z(t,e,se)?J(o,t,e,se):(console.log(e),t.DrawTerrainCell(e.coordinateX,e.coordinateY))}function Ce(o,t,e){Z(t,e,ie)?J(o,t,e,ie):(console.log(e),t.DrawTerrainCell(e.coordinateX,e.coordinateY))}function Te(o,t,e){Z(t,e,re)?J(o,t,e,re):(console.log(e),t.DrawTerrainCell(e.coordinateX,e.coordinateY))}function we(o,t){for(let e=0;e<t.terrain.length;e++)for(let s=0;s<t.terrain[e].length;s++)e===0||e===t.terrain[e].length-1?new y(o,t,e*r,s*r,!0):e!==0&&(s===0||s===t.terrain[e].length-1)&&new y(o,t,e*r,s*r)}function Y(o){return Math.floor(Math.random()*(o+1))}function Fe(){const o=Y(255),t=Y(255),e=Y(255);return"rgb("+o+", "+t+", "+e+")"}function ce(o,t){const e=Math.floor(Math.random()*(o+1)),s=Math.floor(Math.random()*(t+1));return{coordinateX:e,coordinateY:s}}function Se(o,t,e,s){const i=Math.floor(Math.random()*(t-o+1))+o,n=Math.floor(Math.random()*(s-e+1))+e;return{coordinateX:i,coordinateY:n}}function R(o,t,e){const s=t.availableFruits.reduce((n,c)=>n+c.weight,0);let i=Y(s);for(const n of t.availableFruits){if(i<n.weight)return new n.food(o,e);i-=n.weight}}class Ee{constructor(t,e,s){this.context=t,this.terrainWidth=e,this.terrainHeight=s,this.terrain=new Array(this.terrainWidth),this.InitializeTerrain()}InitializeTerrain(){for(let t=0;t<this.terrain.length;t++){this.terrain[t]=new Array(this.terrainHeight);for(let e=0;e<this.terrain[t].length;e++)this.WriteTerrainCell([t],[e],!1,"ground",null)}}DrawTerrain(){for(let t=0;t<this.terrain.length;t++){this.context.fillStyle=Fe;for(let e=0;e<this.terrain[t].length;e++)this.context.fillStyle="#FFFFFF",this.context.fillStyle="#fff89e",this.context.fillRect(t*r,e*r,r,r),this.context.strokeRect(t*r,e*r,r,r)}}DrawTerrainCell(t,e){this.context.fillStyle="#FFFFFF",this.context.fillStyle="#fff89e",this.context.fillRect(t,e,r,r),this.context.strokeRect(t,e,r,r),this.WriteTerrainCell(t/r,e/r,!1,"ground",null)}ReadTerrainCell(t,e){return t===35&&(t=34),e===35&&(e=34),this.terrain[t][e]}WriteTerrainCell(t,e,s,i,n){this.terrain[t][e]={isOccupied:s,type:i,object:n}}}class oe{constructor(t,e,s,i="#71B340"){this.context=t,this.coordinateX=e,this.coordinateY=s,this.color=i}DrawSegment(){this.context.fillStyle=this.color,this.context.fillRect(this.coordinateX,this.coordinateY,r,r)}MoveSegment(t,e){this.coordinateX=t,this.coordinateY=e,this.DrawSegment()}}let K=0,W=0;const De=15,ne=1e3/De;function le(o=0,t){K=requestAnimationFrame(s=>le(s,t)),W===0&&(W=o);let e=o-W;e>=ne&&(t.MoveSnake(ae),W=o-e%ne)}function Xe(){cancelAnimationFrame(K),K=0}class Ye{constructor(t,e,s,i,n,c,D="#2F4C31"){this.document=t,this.context=e,this.player=s,this.terrain=i,this.coordinateX=n,this.coordinateY=c,this.color=D,this.head=new oe(this.context,this.coordinateX,this.coordinateY,this.color),this.segments=[],this.segments.push(this.head),this.segments[0].DrawSegment(),this.document.addEventListener("keydown",X=>{switch(X.key){case"z":I(0);break;case"s":I(1);break;case"q":I(2);break;case"d":I(3);break}})}MoveSnakeSegments(t,e){for(let s=this.segments.length-1;s>=0;s--)if(s===0){this.segments.length===1&&this.terrain.DrawTerrainCell(this.segments[s].coordinateX,this.segments[s].coordinateY);let i=this.terrain.ReadTerrainCell(t/r,e/r);i.type==="sweetFruit"?(this.AddSegment(i.object.segmentsToAdd),this.player.GainExp(i.object.experience),R(this.context,this.player,this.terrain)):i.type==="sourFruit"?(this.RemoveSegment(i.object.segmentsToRemove),this.player.GainExp(i.object.experience),R(this.context,this.player,this.terrain)):(i.type==="obstacleCell"||i.type==="segment")&&(Xe(),this.player.SaveToLocalStorage()),this.segments[s].MoveSegment(t,e),this.terrain.WriteTerrainCell(t/r,e/r,!0,"head",this)}else{let i=this.segments[s-1].coordinateX,n=this.segments[s-1].coordinateY;s===this.segments.length-1&&(this.terrain.DrawTerrainCell(this.segments[s].coordinateX,this.segments[s].coordinateY),this.terrain.WriteTerrainCell(this.segments[s].coordinateX/r,this.segments[s].coordinateY/r,!1,"ground",null)),this.segments[s].MoveSegment(i,n),this.terrain.WriteTerrainCell(i/r,n/r,!0,"segment",this)}}MoveSnake(t){let e=0,s=0;switch(t){case 0:e=this.segments[0].coordinateX,s=this.segments[0].coordinateY-r,this.MoveSnakeSegments(e,s);break;case 1:e=this.segments[0].coordinateX,s=this.segments[0].coordinateY+r,this.MoveSnakeSegments(e,s);break;case 2:e=this.segments[0].coordinateX-r,s=this.segments[0].coordinateY,this.MoveSnakeSegments(e,s);break;case 3:e=this.segments[0].coordinateX+r,s=this.segments[0].coordinateY,this.MoveSnakeSegments(e,s);break}}AddSegment(t){for(let e=0;e<t;e++){const s=new oe(this.context,600,6e3);this.segments.push(s)}}RemoveSegment(t){for(let e=0;e<t;e++){if(this.segments[this.segments.length-1],this.segments.length===1)return;{const s=this.segments[this.segments.length-1].coordinateX,i=this.segments[this.segments.length-1].coordinateY;this.terrain.DrawTerrainCell(s,i),this.terrain.WriteTerrainCell(s/r,i/r,!1,"ground",null),this.segments.splice(this.segments.length-1,1)}}}}class Re{constructor(t){this.username=t,this.accountLevel=1,this.accountExp=0,this.accountExpThreshold=100,this.scalingFactor=1.2,this.availableFruits=[],localStorage.length>0&&this.LoadFromLocalStorage(),this.SetAvailableFruit(),console.log(this.availableFruits)}LoadFromLocalStorage(){this.username=localStorage.getItem("username"),this.accountLevel=parseInt(localStorage.getItem("accountLevel")),this.accountExp=parseInt(localStorage.getItem("accountExp")),this.accountExpThreshold=parseInt(localStorage.getItem("accountExpThreshold"))}SaveToLocalStorage(){localStorage.setItem("username",this.username),localStorage.setItem("accountLevel",this.accountLevel.toString()),localStorage.setItem("accountExp",this.accountExp.toString()),localStorage.setItem("accountExpThreshold",this.accountExpThreshold.toString())}GainExp(t){this.accountExp+=t,this.CheckLevelUp(),this.UpdateExperienceUI()}CheckLevelUp(){for(;this.accountExp>=this.accountExpThreshold;)this.accountExp-=this.accountExpThreshold,this.accountLevel++,this.accountExpThreshold=Math.ceil(this.accountExpThreshold+100)}UpdateExperienceUI(){const t=this.accountExp/this.accountExpThreshold*100,e=document.getElementById("levelTextualIndicator");e.textContent="Niveau "+this.accountLevel+" - "+this.accountExp+" / "+this.accountExpThreshold+" Exp.";const s=document.getElementById("progressBarValue");s.style.width=t+"%"}SetAvailableFruit(){this.accountLevel>=1&&this.availableFruits.push({food:M,weight:1e3}),this.accountLevel>=4&&this.availableFruits.push({food:U,weight:800}),this.accountLevel>=8&&this.availableFruits.push({food:P,weight:600}),this.accountLevel>=16&&this.availableFruits.push({food:q,weight:400}),this.accountLevel>=24&&this.availableFruits.push({food:z,weight:300}),this.accountLevel>=32&&this.availableFruits.push({food:O,weight:100}),this.accountLevel>=40&&this.availableFruits.push({food:j,weight:50}),this.accountLevel>=12&&this.availableFruits.push({food:N,weight:750}),this.accountLevel>=20&&this.availableFruits.push({food:G,weight:500}),this.accountLevel>=28&&this.availableFruits.push({food:H,weight:250}),this.accountLevel>=36&&this.availableFruits.push({food:B,weight:150}),this.accountLevel>=44&&this.availableFruits.push({food:V,weight:25})}}const h=new Re("Rift"),be=document.getElementById("canvas"),S=be.getContext("2d"),E=new Ee(S,35,35);E.DrawTerrain();const he=new Ye(document,S,h,E,40,100);he.segments[0].DrawSegment();le(0,he);we(S,E);xe(S,E);R(S,h,E);R(S,h,E);R(S,h,E);const Q=document.getElementById("container__aside"),de=document.createElement("h1");de.textContent="Bienvenue, "+h.username+" !";Q.appendChild(de);const $=document.createElement("h2");$.id="levelTextualIndicator";$.textContent="Niveau "+h.accountLevel+" - "+h.accountExp+" / "+h.accountExpThreshold+" Exp.";Q.appendChild($);const A=document.createElement("div");A.id="progressBar";A.className="progressBar";const _=document.createElement("div");_.id="progressBarValue";_.className="progressBarValue";A.appendChild(_);Q.appendChild(A);h.UpdateExperienceUI();
